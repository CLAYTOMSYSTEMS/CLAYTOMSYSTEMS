<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>ClayTomSystems — Centro de Comando Empresarial Molecular</title>
    <style>
        html, body, #scene {
            height: 100%;
            margin: 0;
            background: #020617;
            color: #e2e8f0;
            font-family: system-ui, -apple-system, sans-serif;
            overflow: hidden;
        }
        
        .hud {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(2, 6, 23, 0.8);
            padding: 20px 24px;
            border-radius: 16px;
            border: 1px solid #0ea5e9;
            backdrop-filter: blur(10px);
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(14, 165, 233, 0.2);
        }
        
        .hud strong {
            font-size: 18px;
            color: #0ea5e9;
            display: block;
            margin-bottom: 15px;
        }
        
        .hud .subtitle {
            font-size: 12px;
            opacity: 0.7;
            margin-bottom: 20px;
        }
        
        .btn {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            color: #ffffff;
            border: none;
            padding: 12px 16px;
            border-radius: 10px;
            cursor: pointer;
            margin: 4px 8px 4px 0;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #0284c7, #0369a1);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(14, 165, 233, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        #status {
            display: inline-block;
            margin-left: 12px;
            padding: 6px 12px;
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .company-info {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(2, 6, 23, 0.8);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid rgba(14, 165, 233, 0.3);
            backdrop-filter: blur(10px);
            max-width: 300px;
            z-index: 1000;
        }
        
        .company-info h3 {
            margin: 0 0 10px 0;
            color: #0ea5e9;
            font-size: 16px;
        }
        
        .company-info p {
            margin: 5px 0;
            font-size: 13px;
            opacity: 0.8;
        }
        
        .metrics {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(2, 6, 23, 0.8);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid rgba(239, 68, 68, 0.3);
            backdrop-filter: blur(10px);
            z-index: 1000;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 13px;
        }
        
        .metric-value {
            color: #ef4444;
            font-weight: 600;
        }
        
        /* SANDRA MICRO CONVERSACIONAL STYLES */
        .sandra-micro {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
            transition: all 0.3s ease;
            z-index: 1001;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .sandra-micro:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(16, 185, 129, 0.6);
        }
        
        .sandra-icon {
            font-size: 24px;
            color: white;
        }
        
        .sandra-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(2, 6, 23, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(10px);
        }
        
        .sandra-container {
            background: rgba(2, 6, 23, 0.95);
            color: #e2e8f0;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(14, 165, 233, 0.3);
            border: 1px solid #0ea5e9;
        }
        
        .sandra-header {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .sandra-header h3 {
            margin: 0 0 5px 0;
            font-size: 18px;
            font-weight: 600;
        }
        
        .sandra-header p {
            margin: 0;
            font-size: 12px;
            opacity: 0.9;
        }
        
        .sandra-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s ease;
        }
        
        .sandra-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .sandra-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            min-height: 300px;
            max-height: 400px;
        }
        
        .sandra-message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 80%;
        }
        
        .sandra-message.user-message {
            background: rgba(14, 165, 233, 0.2);
            color: #0ea5e9;
            margin-left: auto;
            text-align: right;
            border: 1px solid rgba(14, 165, 233, 0.3);
        }
        
        .sandra-message.ai-message {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            margin-right: auto;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .sandra-input {
            display: flex;
            padding: 20px;
            gap: 10px;
            border-top: 1px solid rgba(14, 165, 233, 0.3);
        }
        
        .sandra-input input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid rgba(14, 165, 233, 0.3);
            border-radius: 25px;
            outline: none;
            font-size: 14px;
            background: rgba(2, 6, 23, 0.5);
            color: #e2e8f0;
        }
        
        .sandra-input input:focus {
            border-color: #0ea5e9;
        }
        
        .sandra-input button {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .sandra-input button:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }
        
        .sandra-mic-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-left: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .sandra-mic-btn:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        }
        
        .sandra-mic-btn.recording {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            animation: pulse-mic 1.5s infinite;
        }
        
        .sandra-mic-btn.voice-mode {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            border: 2px solid #a855f7;
        }
        
        .sandra-mic-btn.voice-mode:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
        }
        
        @keyframes pulse-mic {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @media (max-width: 768px) {
            .hud {
                top: 10px;
                left: 10px;
                right: 10px;
                padding: 15px;
            }
            
            .btn {
                padding: 10px 12px;
                margin: 3px 5px 3px 0;
                font-size: 12px;
            }
            
            .company-info, .metrics {
                display: none;
            }
            
            .sandra-micro {
                width: 50px;
                height: 50px;
                bottom: 15px;
                left: 15px;
            }
            
            .sandra-icon {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="scene"></div>
    
    <!-- HUD Centro de Comando -->
    <div class="hud">
        <strong>ClayTomSystems — Centro de Comando Empresarial</strong>
        <div class="subtitle">Gestión de Infraestructura Molecular</div>
        
        <div>
            <button class="btn" onclick="sendCommand('system.activate', {agents: 50})">🚀 Activar 50 Agentes</button>
            <button class="btn" onclick="sendCommand('system.scale', {nodes: 100})">⚡ Escalar 100 Nodos</button>
            <button class="btn" onclick="sendCommand('ai.train', {models: 25})">🧠 Entrenar 25 Modelos</button>
        </div>
        
        <div style="margin-top: 12px;">
            <button class="btn" onclick="sendCommand('deploy.production', {services: 'all'})">🌐 Desplegar Producción</button>
            <button class="btn" onclick="sendCommand('security.scan', {depth: 'full'})">🛡️ Escaneo Seguridad</button>
            <button class="btn" onclick="sendCommand('optimize.performance', {target: 'global'})">⚙️ Optimizar</button>
        </div>
        
        <span id="status">LISTO</span>
    </div>
    
    <!-- Métricas en Tiempo Real -->
    <div class="metrics">
        <h4 style="margin: 0 0 12px 0; color: #ef4444; font-size: 14px;">⚡ Métricas en Vivo</h4>
        <div class="metric">
            <span>Agentes Activos:</span>
            <span class="metric-value" id="agents">1,247</span>
        </div>
        <div class="metric">
            <span>Poder de Procesamiento:</span>
            <span class="metric-value" id="power">89.4%</span>
        </div>
        <div class="metric">
            <span>Carga de Red:</span>
            <span class="metric-value" id="network">67.2%</span>
        </div>
        <div class="metric">
            <span>Estado de Seguridad:</span>
            <span class="metric-value" id="security">PROTEGIDO</span>
        </div>
    </div>
    
    <!-- Información Corporativa -->
    <div class="company-info">
        <h3>🏢 ClayTomSystems Corp</h3>
        <p><strong>CEO:</strong> Clay Thomas</p>
        <p><strong>Enfoque:</strong> Infraestructura IA y Automatización</p>
        <p><strong>Servicios:</strong> Soluciones IA Empresariales</p>
        <p><strong>Email:</strong> info@claytomsystems.com</p>
        <p style="margin-top: 15px; font-size: 11px; opacity: 0.6;">
            Diseño molecular por GPT-5 ⚡
        </p>
    </div>

    <!-- SANDRA MICRO CONVERSACIONAL LIMPIO -->
    <div class="sandra-micro" id="sandraMicro" onclick="toggleSandraChat()">
        <div class="sandra-icon">🤖</div>
    </div>

    <!-- SANDRA CHAT MODAL -->
    <div class="sandra-modal" id="sandraModal">
        <div class="sandra-container">
            <div class="sandra-header">
                <button class="sandra-close" onclick="toggleSandraChat()">×</button>
                <h3>Sandra IA 7.0 Asistente</h3>
                <p>Inteligencia Artificial Empresarial ClayTomSystems</p>
            </div>
            <div class="sandra-messages" id="sandraMessages">
                <div class="sandra-message ai-message">
                    Hola, soy Sandra IA 7.0. ¿En qué puedo ayudarte con ClayTomSystems?
                </div>
            </div>
            <div class="sandra-input">
                <input type="text" id="sandraInput" placeholder="Pregúntame sobre ClayTomSystems..." onkeypress="handleSandraKeyPress(event)">
                <button onclick="sendSandraMessage()">Enviar</button>
                <button class="sandra-mic-btn" id="sandraMicBtn" onclick="toggleSandraVoice()" title="Conversación por voz con Sandra">🎤</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
    <script>
        // Molecular 3D Scene Setup
        const container = document.getElementById('scene');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x020617, 1);
        container.appendChild(renderer.domElement);

        // Create multiple particle systems for molecular effect
        const particleSystems = [];
        
        // Main molecular structure with organic shapes
        const createParticleSystem = (count, color, size, speed) => {
            const geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(count * 3);
            
            // Generate organic, spherical distribution instead of cubic
            for (let i = 0; i < count; i++) {
                const index = i * 3;
                
                // Create spherical/organic distribution with noise
                const radius = Math.random() * 200 + 50;
                const theta = Math.random() * Math.PI * 2; // 0 to 2π
                const phi = Math.acos(2 * Math.random() - 1); // 0 to π
                
                // Add organic distortion with multiple sine waves
                const distortion = Math.sin(theta * 3) * Math.cos(phi * 2) * 30;
                const finalRadius = radius + distortion;
                
                // Convert spherical to cartesian coordinates
                positions[index] = finalRadius * Math.sin(phi) * Math.cos(theta);
                positions[index + 1] = finalRadius * Math.sin(phi) * Math.sin(theta);
                positions[index + 2] = finalRadius * Math.cos(phi);
            }
            
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            const material = new THREE.PointsMaterial({ 
                color: color, 
                size: size,
                transparent: true,
                opacity: 0.8
            });
            const points = new THREE.Points(geometry, material);
            points.userData = { speed: speed };
            return points;
        };

        // Create multiple layers
        particleSystems.push(createParticleSystem(2000, 0x0ea5e9, 1.5, 0.0008));
        particleSystems.push(createParticleSystem(1000, 0x0284c7, 2, 0.0005));
        particleSystems.push(createParticleSystem(500, 0xef4444, 1, 0.001));

        particleSystems.forEach(system => scene.add(system));

        camera.position.z = 200;

        // Animation loop with enhanced effects
        function animate() {
            requestAnimationFrame(animate);
            
            particleSystems.forEach((system, index) => {
                system.rotation.y += system.userData.speed;
                system.rotation.x += system.userData.speed * 0.5;
                
                // Pulsing effect
                const time = Date.now() * 0.001;
                system.material.opacity = 0.6 + Math.sin(time + index) * 0.2;
            });
            
            renderer.render(scene, camera);
        }
        animate();

        // Command system with enhanced feedback
        async function sendCommand(type, payload) {
            const status = document.getElementById('status');
            status.textContent = 'PROCESANDO...';
            status.style.background = 'rgba(239, 68, 68, 0.2)';
            status.style.color = '#ef4444';
            
            try {
                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 800));
                
                status.textContent = 'ÉXITO';
                status.style.background = 'rgba(34, 197, 94, 0.2)';
                status.style.color = '#22c55e';
                
                console.log(`Command executed: ${type}`, payload);
                
                // Update metrics
                updateMetrics();
                
                // Reset status after delay
                setTimeout(() => {
                    status.textContent = 'LISTO';
                }, 2000);
                
            } catch (error) {
                status.textContent = 'ERROR';
                status.style.background = 'rgba(239, 68, 68, 0.3)';
                status.style.color = '#ef4444';
                console.error('Command failed:', error);
            }
        }

        // Real-time metrics simulation
        function updateMetrics() {
            document.getElementById('agents').textContent = Math.floor(Math.random() * 500 + 1000).toLocaleString();
            document.getElementById('power').textContent = (Math.random() * 20 + 75).toFixed(1) + '%';
            document.getElementById('network').textContent = (Math.random() * 30 + 50).toFixed(1) + '%';
            
            const securityStates = ['PROTEGIDO', 'ESCANEANDO', 'OPTIMIZADO'];
            document.getElementById('security').textContent = securityStates[Math.floor(Math.random() * securityStates.length)];
        }

        // Update metrics every 5 seconds
        setInterval(updateMetrics, 5000);

        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Initialize metrics
        updateMetrics();

        // SANDRA MICRO CONVERSACIONAL FUNCTIONALITY - SIN APIS EXTERNAS
        let sandraOpen = false;
        let sandraRecognition = null;
        let sandraListening = false;
        let sandraSpeechSynthesis = null;
        let sandraVoiceMode = false;
        let sandraInterrupted = false;
        
        function toggleSandraChat() {
            const modal = document.getElementById('sandraModal');
            const micro = document.getElementById('sandraMicro');
            
            sandraOpen = !sandraOpen;
            
            if (sandraOpen) {
                modal.style.display = 'flex';
                document.getElementById('sandraInput').focus();
            } else {
                modal.style.display = 'none';
            }
        }
        
        function sendSandraMessage(fromVoice = false) {
            const input = document.getElementById('sandraInput');
            const messagesContainer = document.getElementById('sandraMessages');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            const userMessage = document.createElement('div');
            userMessage.className = 'sandra-message user-message';
            userMessage.textContent = message;
            messagesContainer.appendChild(userMessage);
            
            // Clear input
            input.value = '';
            
            // Simulate Sandra IA 7.0 response - SIN APIS EXTERNAS
            setTimeout(() => {
                const response = generateSandraResponse(message);
                const aiMessage = document.createElement('div');
                aiMessage.className = 'sandra-message ai-message';
                aiMessage.textContent = response;
                messagesContainer.appendChild(aiMessage);
                
                // If in voice mode, speak the response
                if (sandraVoiceMode || fromVoice) {
                    speakSandraResponse(response);
                }
                
                // Scroll to bottom
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 800);
            
            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function handleSandraKeyPress(event) {
            if (event.key === 'Enter') {
                sendSandraMessage();
            }
        }
        
        function generateSandraResponse(userMessage) {
            const responses = [
                "ClayTomSystems se especializa en infraestructura AI empresarial con sistemas moleculares avanzados. ¿Necesitas más información sobre algún servicio específico?",
                "Como Sandra IA 7.0, puedo ayudarte con automatización empresarial, gestión de agentes AI y optimización de sistemas. ¿En qué proyecto estás trabajando?",
                "ClayTomSystems ofrece soluciones completas de AI para empresas. Nuestro CEO Clay Thomas lidera el desarrollo de tecnologías moleculares. ¿Te interesa algún sector específico?",
                "Mi función es asistir con consultas sobre ClayTomSystems y sus servicios de AI empresarial. Puedo proporcionar información técnica y comercial. ¿Qué necesitas saber?",
                "Los sistemas moleculares de ClayTomSystems procesan miles de agentes simultáneamente. Esto es ideal para empresas que necesitan escalabilidad masiva. ¿Manejas proyectos de gran escala?",
                "Sandra IA 7.0 está integrada en todos los servicios de ClayTomSystems para proporcionar soporte inteligente 24/7. ¿Necesitas implementar algo similar en tu empresa?",
                "ClayTomSystems ha desarrollado esta arquitectura molecular para optimizar el rendimiento empresarial. ¿Te interesa una demostración técnica?",
                "Como asistente de ClayTomSystems, puedo ayudarte con información sobre precios, implementación y soporte técnico. ¿Cuál es tu consulta específica?"
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }
        
        // SANDRA VOICE RECOGNITION & SYNTHESIS FUNCTIONALITY
        function initSandraVoice() {
            // Initialize Speech Recognition
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                sandraRecognition = new SpeechRecognition();
                sandraRecognition.lang = 'es-ES';
                sandraRecognition.continuous = true;  // Keep listening
                sandraRecognition.interimResults = true;

                sandraRecognition.onstart = function() {
                    sandraListening = true;
                    updateMicrophoneState();
                };

                sandraRecognition.onresult = function(event) {
                    const lastResult = event.results[event.results.length - 1];
                    if (lastResult.isFinal) {
                        const transcript = lastResult[0].transcript.trim();
                        if (transcript) {
                            // Stop Sandra if she's speaking (barge-in)
                            if (sandraSpeechSynthesis && sandraSpeechSynthesis.speaking) {
                                sandraSpeechSynthesis.cancel();
                                sandraInterrupted = true;
                            }
                            
                            const input = document.getElementById('sandraInput');
                            input.value = transcript;
                            sendSandraMessage(true);
                        }
                    }
                };

                sandraRecognition.onend = function() {
                    // Auto-restart if in voice mode
                    if (sandraVoiceMode && !sandraInterrupted) {
                        setTimeout(() => {
                            if (sandraVoiceMode) {
                                sandraRecognition.start();
                            }
                        }, 100);
                    } else {
                        sandraListening = false;
                        updateMicrophoneState();
                    }
                    sandraInterrupted = false;
                };

                sandraRecognition.onerror = function(event) {
                    console.log('Error de reconocimiento de voz:', event.error);
                    if (event.error === 'no-speech' && sandraVoiceMode) {
                        // Restart if no speech detected but still in voice mode
                        setTimeout(() => {
                            if (sandraVoiceMode) {
                                sandraRecognition.start();
                            }
                        }, 1000);
                    }
                };
            }

            // Initialize Speech Synthesis
            if ('speechSynthesis' in window) {
                sandraSpeechSynthesis = window.speechSynthesis;
            }
        }

        function updateMicrophoneState() {
            const micBtn = document.getElementById('sandraMicBtn');
            
            if (sandraVoiceMode) {
                micBtn.classList.add('voice-mode');
                micBtn.classList.remove('recording');
                micBtn.textContent = '🗣️';
                micBtn.title = 'Modo conversacional activo - Clic para desactivar';
                
                if (sandraListening) {
                    micBtn.classList.add('recording');
                }
            } else {
                micBtn.classList.remove('voice-mode', 'recording');
                micBtn.textContent = '🎤';
                micBtn.title = 'Conversación por voz con Sandra';
            }
        }

        function toggleSandraVoice() {
            if (!sandraRecognition) {
                initSandraVoice();
            }

            if (sandraVoiceMode) {
                // Stop voice mode
                sandraVoiceMode = false;
                if (sandraRecognition) {
                    sandraRecognition.stop();
                }
                if (sandraSpeechSynthesis && sandraSpeechSynthesis.speaking) {
                    sandraSpeechSynthesis.cancel();
                }
            } else {
                // Start voice mode
                sandraVoiceMode = true;
                if (sandraRecognition) {
                    sandraRecognition.start();
                } else {
                    alert('Tu navegador no soporta reconocimiento de voz. Usa Chrome, Edge o Safari.');
                    sandraVoiceMode = false;
                }
            }
            
            updateMicrophoneState();
        }

        function speakSandraResponse(text) {
            if (sandraSpeechSynthesis) {
                // Cancel any ongoing speech
                sandraSpeechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'es-ES';
                utterance.rate = 0.9;
                utterance.pitch = 1.1;
                utterance.volume = 0.8;

                // Find a Spanish female voice if available
                const voices = sandraSpeechSynthesis.getVoices();
                const spanishVoice = voices.find(voice => 
                    voice.lang.startsWith('es') && voice.name.toLowerCase().includes('female')
                ) || voices.find(voice => voice.lang.startsWith('es'));
                
                if (spanishVoice) {
                    utterance.voice = spanishVoice;
                }

                utterance.onend = function() {
                    // After Sandra finishes speaking, restart listening if in voice mode
                    if (sandraVoiceMode && sandraRecognition) {
                        setTimeout(() => {
                            if (sandraVoiceMode && !sandraListening) {
                                sandraRecognition.start();
                            }
                        }, 500);
                    }
                };

                sandraSpeechSynthesis.speak(utterance);
            }
        }

        // Initialize voice recognition on page load
        window.addEventListener('load', function() {
            initSandraVoice();
        });

        // Close modal when clicking outside
        document.getElementById('sandraModal').addEventListener('click', function(event) {
            if (event.target === this) {
                toggleSandraChat();
            }
        });
    </script>
</body>
</html>